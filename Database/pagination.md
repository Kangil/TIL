# DB Pagination Best Practice
웹페이지상에서 페이징이 필요한 경우 

- Mysql, InnoDB 기준. (DBMS나 DB 엔진에 따라 달라질 수 있음)
- 아래의 조건을 가정
- 'TABLE' 이란 테이블에 데이터 존재하며 '_id' 라는 이름의 pk값 존재
- 데이터는 한페이지에 20개씩 화면에 10페이지씩 보여줌
- 웹페이지 상에서의 페이징 형식은 아래의 형태로 동작
```
1 2 3 4 5 6 7 8 9 10 >>
```
> \>\> 클릭시 11페이지 데이터가 로드되며 아래의 형식으로 변경

```
<< 11 12 13 14 15 16 17 18 19 20 >>
```
> \<\< 클릭시 9페이지 데이터가 로드되며 가장 처음의 형식으로 변경, >\>\ 클릭시에는 21페이지로 이동 & 아래형식

```
<< 21 22 23 24 25
```

## 데이터 로드 방식

### 각 페이지 별로 데이터 로드

각 페이지를 누를때마다 페이지 단위로 데이터를 가져오는 방식으로
DB상에서는 LIMIT를 사용하여 offset, 가져올 데이터수를 지정하여 가져오는 방법   

```dql
SELECT * FROM TABLE LIMIT 0, 20
```

- 구현이 간편 (페이지 번호에 따라 offset만 계산하여 쿼리 생성)
- 페이지 이동이 일어날때마다 서버 요청이 필요하므로 페이지 열리는 속도가 느림
- 뒷 페이지로 갈수록 데이터를 가져오는 속도가 느려짐 (데이터가 인덱싱되었어도 LIMIT 부분의 데이터는 읽게되므로)

```sql
SELECT * FROM TABLE LIMIT (20*10), 20
```
> 200번째 데이터부터 20개를 읽는게 아니라 200개의 데이터를 읽고버린 후 20개를 처리


### 10개의 페이지를 모아서 블록별로 데이터 로드
화면상에 보이는 10개의 페이지 데이터를 한번에 가져오는 방식으로
201개의 데이터를 한번에 가져옴. 마지막 201번째 데이터는 다음 블록이 존재하는지 여부를 판단하기 위한 용도

```sql
SELECT * FROM TABLE LIMIT 200, 201
```
> 11페이지를 클릭했을 경우의 쿼리

- 블록단위로 데이터를 가져오므로 페이지간 이동이 빠름
- 가져온 데이터를 가지고 현재 페이지 필요한 20개만 보여주는 추가 작업이 필요
- 뒷 페이지로 갈수록 데이터를 가져오는 속도가 느려짐 (위의 페이지별 로드와 동일)


## 개선점
데이터 로드 방식 두가지 모두 LIMIT를 사용하여 DB에서 데이터를 불러오는 위에서 설명했듯이
LIMIT의 경우 실제 offset까지 데이터를 읽고 버리는 작업이 있으므로 뒤로 갈수록 느려지는 단점이 존재

### DB 쿼리내 LIMIT에서 offset을 항상 0으로 사용
데이터를 가져올 때 pk를 같이 가져와서 LIMIT가 아닌 where 절에서 전 페이지 마지막 데이터의 pk보다 큰
값을 조건으로 사용
```sql
SELECT * FROM TABLE WHERE _id > 200 LIMIT 0, 10
```

> 이렇게 처리시 한번에 가져올 데이터에 접근이 가능

- 단 where 절을 index를 사용할 수 있도록 처리하지 않으면 효과가 없음